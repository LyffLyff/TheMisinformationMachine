[gd_scene load_steps=6 format=3 uid="uid://di3cfsc8a1ps3"]

[ext_resource type="Script" uid="uid://bfcvx0lqfmbqe" path="res://scenes/ui/game_finish/run_failed.gd" id="1_ybjm5"]

[sub_resource type="Shader" id="Shader_i8df0"]
code = "shader_type canvas_item;

// Uniforms for customization
uniform sampler2D noise_texture : repeat_enable;
uniform vec4 smoke_color : source_color = vec4(0.8);
uniform float distortion_speed : hint_range(0.0, 5.0) = 0.2;
uniform float density : hint_range(0.0, 1.0) = 1.0;

void fragment() {
    float t = TIME * distortion_speed;

	// Slow, gentle, quasi-random offsets
	float time_offset_1 = 0.05 * sin(t * 0.5 + 1.0)
	                    + 0.03 * cos(t * 0.7 + 2.0)
	                    + 0.02 * sin(t * 1.1 + 0.3);

	float time_offset_2 = 0.04 * cos(t * 0.6 + 1.5)
	                    + 0.03 * sin(t * 0.9 + 0.8)
	                    + 0.02 * cos(t * 1.3 + 0.2);

    // Sample noise with distortion
    vec4 noise = texture(noise_texture, UV + time_offset_1);

    // Create distorted UV and sample final noise
    vec2 distorted_uv = UV + noise.rg * 0.1 - 0.05 + time_offset_2;
    float final_noise = texture(noise_texture, distorted_uv).r;

    float smoke_alpha = final_noise * density * smoke_color.a;

    // Output color
    COLOR = vec4(smoke_color.rgb, smoke_alpha);
}"

[sub_resource type="FastNoiseLite" id="FastNoiseLite_ybjm5"]
noise_type = 2
seed = 50
offset = Vector3(468.09, 0, 0)

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_j6b1i"]
width = 800
height = 500
noise = SubResource("FastNoiseLite_ybjm5")
seamless = true
seamless_blend_skirt = 1.0

[sub_resource type="ShaderMaterial" id="ShaderMaterial_72kia"]
shader = SubResource("Shader_i8df0")
shader_parameter/noise_texture = SubResource("NoiseTexture2D_j6b1i")
shader_parameter/smoke_color = Color(0.8, 0.8, 0.8, 0.38039216)
shader_parameter/distortion_speed = 0.50000002375
shader_parameter/density = 0.2000000095

[node name="RunFailed" type="PanelContainer"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = ExtResource("1_ybjm5")

[node name="ColorRect" type="ColorRect" parent="."]
material = SubResource("ShaderMaterial_72kia")
layout_mode = 2
